<!doctype html><html><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns#"><title>Buck: genrule()</title><link type="image/png" rel="icon" href="/buck/favicon.png" /><meta http-equiv="content-type" content="text/html;charset=utf-8"><link type="text/css" rel="stylesheet" href="/buck/google-code-prettify/prettify.css" ><link type="text/css" rel="stylesheet" href="/buck/buck.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40185670-1', 'github.io'); ga('send', 'pageview');</script><meta property="og:locale" content="en_US"><meta property="og:title" content="genrule()"><meta property="og:site_name" content="Buck: an Android build tool"><meta property="og:image" content="http://newsroom.fb.com/display-media/265/4"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="690"><meta property="og:image:height" content="690"><meta property="og:type" content="article"><meta property="fb:admins" content="584556688222168"></head><body><a href="https://github.com/facebook/buck"><img id="fork" src="/buck/fork_me.png" alt="Fork me on GitHub"></a><div id="fb-root"></div><script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=584556688222168"; fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));</script><h1><div class="titlebar"><div class="fb-like buck_like" data-send="false" data-layout="standard" data-width="350" data-show-faces="false" data-colorscheme="light" data-action="like"></div><div>Buck: genrule()</div></div></h1><div class="content_frame"><div class="toc"><ul class="toc_root"><li><span class="toc_header">Getting Started</span><ul><li><a href="/buck/">Overview</a><li><a href="/buck/setup/quickstart.html">Quick Start</a><li><a href="/buck/setup/install.html">Downloading and Installing Buck</a></ul><li><span class="toc_header">Concepts</span><ul><li><a href="/buck/concept/build_rule.html">Build Rule</a><li><a href="/buck/concept/build_target.html">Build Target</a><li><a href="/buck/concept/build_file.html">Build File</a><li><a href="/buck/concept/buckversion.html">.buckversion</a><li><a href="/buck/concept/nobuckcheck.html">.nobuckcheck</a><li><a href="/buck/concept/buckconfig.html">.buckconfig</a><li><a href="/buck/concept/build_target_pattern.html">Build Target Pattern</a><li><a href="/buck/concept/visibility.html">Visibility</a><li><a href="/buck/concept/troubleshooting.html">Troubleshooting</a><li><a href="/buck/concept/faq.html">FAQ</a></ul><li><span class="toc_header">Build Rules</span><ul><li><a href="/buck/rule/android_binary.html">android_binary()</a><li><a href="/buck/rule/android_library.html">android_library()</a><li><a href="/buck/rule/android_resource.html">android_resource()</a><li><a href="/buck/rule/apk_genrule.html">apk_genrule()</a><li><a href="/buck/rule/gen_aidl.html">gen_aidl()</a><li><a href="/buck/rule/genrule.html">genrule()</a><li><a href="/buck/rule/java_binary.html">java_binary()</a><li><a href="/buck/rule/java_library.html">java_library()</a><li><a href="/buck/rule/java_test.html">java_test()</a><li><a href="/buck/rule/keystore.html">keystore()</a><li><a href="/buck/rule/ndk_library.html">ndk_library()</a><li><a href="/buck/rule/prebuilt_jar.html">prebuilt_jar()</a><li><a href="/buck/rule/prebuilt_native_library.html">prebuilt_native_library()</a><li><a href="/buck/rule/project_config.html">project_config()</a></ul><li><span class="toc_header">Functions</span><ul><li><a href="/buck/function/genfile.html">genfile()</a><li><a href="/buck/function/glob.html">glob()</a><li><a href="/buck/function/include_defs.html">include_defs()</a></ul><li><span class="toc_header">Commands</span><ul><li><a href="/buck/command/audit.html">buck audit</a><li><a href="/buck/command/build.html">buck build</a><li><a href="/buck/command/clean.html">buck clean</a><li><a href="/buck/command/install.html">buck install</a><li><a href="/buck/command/project.html">buck project</a><li><a href="/buck/command/targets.html">buck targets</a><li><a href="/buck/command/test.html">buck test</a><li><a href="/buck/command/uninstall.html">buck uninstall</a><li><a href="/buck/command/buckd.html">buckd</a></ul><li><span class="toc_header">Extending Buck</span><ul><li><a href="/buck/extending/macros.html">Custom Macros</a><li><a href="/buck/extending/rules.html">Custom Rules</a></ul><li><span class="toc_header">Contributing to Buck</span><ul><li><a href="https://groups.google.com/group/buck-build">Discussion Group</a><li><a href="https://github.com/facebook/buck/issues/new">Report a Bug</a><li><a href="/buck/contributing/development.html">Development Workflow</a><li><a href="/buck/contributing/codestyle.html">Code Style</a><li><a href="/buck/javadoc">API</a><li><a href="https://github.com/facebook/buck">Browse the Source Code</a></ul></ul></div><div class="content"><div class="overview">A <code>genrule()</code> is used to generate a file from a shell command. It must produce a single output file.<h2>Arguments</h2><ul class="arglist"><li class="arg"><code>name</code> (required) The name of the genrule.<li class="arg"><code>srcs</code> (defaults to <code>[]</code>) A list of files to be used in the shell command.<li class="arg"><code>cmd</code> (required) The shell command to run to generate the output file. It will be subject to the following environment variable substitutions:<dl><dt><code>SRCS</code><dt><dd>A space-delimited string expansion of the <code>srcs</code> argument where each element of <code>srcs</code> will be translated into an absolute path.</dd><dt><code>SRCDIR</code><dt><dd>The absolute path to a directory to which sources are copied to prior to running the command.</dd><dt><code>OUT</code></dt><dd>The output file for the <code>genrule()</code>. The file specified by this variable must always be written by this command. If not, the execution of this rule will be considered a failure, halting the build process.</dd></dl>It is also possible to expand references to other rules within the <code>cmd</code>. This expansion takes two supported forms:<dl><dt><code>$(exe /&#x2F;path/to:target)</code></dt><dd>Expands a build rule that results in an executable to the commands necessary to execute that command. For example, a <code>java_binary()</code> may expand to a call to <code>java -jar path/to/target.jar</code>. Files that are executable (perhaps generated by a <code>genrule()</code>) will also be expanded. If the build rule does not generate an executable output an exception will be thrown and the build will break.</dd><dt><code>$(location /&#x2F;path/to:target)</code></dt><dd>Expands to the location of the output of the build rule. This means that you can refer to these without needing to be aware of how Buck is storing data on the disk mid-build.</dd></dl>Note that all build rules expanded in the command must be listed in the <code>deps</code> parameter of the <code>genrule()</code>.<li class="arg"><code>out</code> (required) The name of the output file. Must be unique within the build file in which the <code>genrule()</code> is declared.<li class="arg"><code>deps</code> (defaults to <code>[]</code>) A list of rules that must be built before this rule. These may be accessed within the <code>cmd</code> by treating the target as a brace-wrapped variable: <code>$(location /&#x2F;like:this)</code>.<li class="arg"><code>visibility</code> (defaults to <code>[]</code>) List of <a href="/buck/concept/build_target_pattern.html">build target patterns</a> that identify the build rules that can include this rule in its <code>deps</code>.</ul><h2>Examples</h2>This genrule() uses a Python script to derive a new <code>AndroidManifest.xml</code> from an <code>AndroidManifest.xml</code> in the source tree.<pre class="prettyprint lang-py">
genrule(
  name = 'generate_manifest',
  srcs = [
    'AndroidManifest.xml',
  ],
  cmd = 'python $(exe //python/android:basic_to_full) ' \
      '$SRCDIR/AndroidManifest.xml > $OUT',
  out = 'AndroidManifest.xml',
  deps = [
    '//python/android:basic_to_full',
  ]
)
</pre><h2>See Also</h2><a href="/buck/function/genfile.html"><code>genfile()</code></a> function.</div></div></div><script src="/buck/google-code-prettify/prettify.js"></script><script>prettyPrint()</script></body></html>